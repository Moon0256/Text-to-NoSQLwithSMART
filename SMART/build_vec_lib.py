import openai
import numpy as np
import json
from tqdm import tqdm
import pickle
from dotenv import load_dotenv
import os
load_dotenv()

# Builds a vector library for training data using OpenAI embeddings, 
vql_embedding_file_path = "./vector_store/train_subset.pkl"
train_path = "../TEND/train_SLM_subset.json"

# Originally
# train_path = "./TEND/train_SLM_prediction.json"
# Changed to use a smaller subset for testing


api_base = "https://api.openai.com/v1"
# Was using a third party OpenAI API endpoint earlier, changed it to the official OpenAI API endpoint

# replace with your OpenAI API key
api_key = os.getenv("OPENAI_API_KEY")

client = openai.Client(api_key=api_key, base_url=api_base)

# To check if the API key is working
# try:
#     res = client.embeddings.create(input="hello", model="text-embedding-ada-002")
#     print(res)
# except Exception as e:
#     print("Error:", e)

cache = {}

with open(train_path, "r", encoding="utf-8") as f:
    train_data = json.load(f)

print(f"Loaded {len(train_data)} examples from subset.")

def get_embedding(text, model="text-embedding-ada-002"):
    if text in cache:
        return cache[text]
    embedding = None
    while embedding is None:
        try:
            embedding = client.embeddings.create(input=text, model=model)
        except Exception as ex:
            print(ex)
            
    cache[text] = np.array(embedding.data[0].embedding) # This line only takes the embedding part of the Embedding object
    return np.array(embedding.data[0].embedding)

vec_lib = []
# if os.path.exists(vql_embedding_file_path):
#     with open(vql_embedding_file_path, "rb") as f:
#         vec_lib = pickle.load(f)

#This code snippet below uses tqdm to generate the loading bar
for id, example in tqdm(enumerate(train_data), total=len(train_data)):

    # if id<len(vec_lib):
    #     continue

    nlq = example['nlq']
    MQL = example['MQL']
    query_collection = example['query_collection'].split(", ")
    fields_db = example['fields_db'].split(", ")
    fields_alias = example['fields_alias'].split(", ")
    target_fields = example['target_fields'].split(", ")
    
    query_collection.sort()
    fields_db.sort()
    fields_alias.sort()
    target_fields.sort()

    query_collection = ", ".join(query_collection)
    fields_db = ", ".join(fields_db)
    fields_alias = ", ".join(fields_alias)
    target_fields = ", ".join(target_fields)

    # Get embeddings for all of the fields
    nlq_emb = get_embedding(nlq)
    MQL_emb = get_embedding(MQL)
    query_collection_emb = get_embedding(query_collection)
    fields_db_emb = get_embedding(fields_db)
    fields_alias_emb = get_embedding(fields_alias)
    target_fields_emb = get_embedding(target_fields)

    # Then create a dictionary with all the fields and their embeddings
    # and append it to the vector library
    vec_lib.append({
        "nlq":{"value":nlq, "embedding":nlq_emb},
        "db_id":example['db_id'],
        "mql":{"value":MQL, "embedding":MQL_emb},
        "fields_db":{"value":fields_db, "embedding":fields_db_emb},
        "fields_alias":{"value":fields_alias, "embedding":fields_alias_emb},
        "target_fields":{"value":target_fields, "embedding":target_fields_emb},
        "query_collection":{"value":query_collection, "embedding":query_collection_emb}
    })

    # Ensure the directory exists
    os.makedirs(os.path.dirname(vql_embedding_file_path), exist_ok=True)


    with open(vql_embedding_file_path, "wb") as f:
        pickle.dump(vec_lib, f)

# Example Object for embedding of Hello:
"""
CreateEmbeddingResponse(data=[Embedding(embedding=[-0.025149881839752197, -0.019527209922671318, -0.028073672205209732, -0.031063610687851906, -0.02477944642305374, 0.02751801908016205, -0.01254186686128378, -0.008434007875621319, -0.017635345458984375, -0.008308324962854385, 0.032571807503700256, 0.004260001238435507, -0.02467360906302929, -0.000596582074649632, 0.014155903831124306, -0.0016008078819140792, 0.03939839452505112, 0.0021514990366995335, 0.027002057060599327, -0.012449258007109165, -0.02114124782383442, 0.008897052146494389, 0.008407549001276493, -0.0032561887055635452, -0.005331616383045912, -0.009585002437233925, 0.011199040338397026, -0.0015330050373449922, 0.003515823744237423, -0.02328447811305523, 0.006793511100113392, -0.007865126244723797, -0.023893048986792564, -0.008923511952161789, 0.006846430245786905, -0.01369286049157381, 0.009611462242901325, -0.01422205287963152, 0.021987956017255783, -0.010550779290497303, 0.0033702957443892956, -0.014671866782009602, 0.005344845820218325, -0.014896773733198643, -0.03175156190991402, 0.01632559485733509, -0.005470529198646545, -0.006638060789555311, -0.009690840728580952, 0.034715037792921066, 0.026380255818367004, 0.009161648340523243, -0.01958012953400612, -0.008004039525985718, -0.0057748151011765, -0.0057615851983428, -0.013573791831731796, 0.006227936130017042, 0.0008202486205846071, -0.038657523691654205, -0.00034232152393087745, 0.019011246040463448, -0.015452425926923752, 0.01870696060359478, -0.0002519866684451699, 0.010762455873191357, 0.01922292448580265, 0.003972252365201712, -0.004524597432464361, 0.022159943357110023, 0.025335099548101425, 0.017278140410780907, 0.006991958245635033, -0.01801901124417782, 0.019156774505972862, -0.010888139717280865, -0.007322703488171101, -0.005401072558015585, -0.014592488296329975, 0.0012799848336726427, 0.015889009460806847, -0.025004353374242783, -0.008447238244116306, 0.013282735832035542, 0.01899801753461361, 0.015121680684387684, -0.021670440211892128, 0.023932738229632378, -0.009690840728580952, -0.028973298147320747, -0.00177775660995394, 0.01807192899286747, 0.008784598670899868, 0.02501758374273777, -0.02141907438635826, 0.0028493718709796667, -0.015015842393040657, 0.031645722687244415, -0.0017926401924341917, -0.008209101855754852, -0.0013668054016306996, 0.013825158588588238, -0.0006540491012856364, -0.003998712170869112, -0.03249242901802063, -0.009499008767306805, -0.012025903910398483, -0.007263169623911381, 0.02386659011244774, 0.010028201155364513, -0.005331616383045912, 0.0267639197409153, -0.002594697754830122, -0.04453156515955925, -0.01485708449035883, -0.006664520129561424, -0.005295234266668558, -0.003644814481958747, -0.012257425114512444, -0.020704664289951324, 0.016868015751242638, 0.002197803230956197, 0.026856528595089912, -0.0035522058606147766, 0.021961495280265808, 0.004293075762689114, -0.01737074926495552, -0.016987085342407227, 0.0046271285973489285, -0.006459458265453577, 0.033683113753795624, 0.003737423336133361, -0.003916025627404451, -0.004537827335298061, -0.020532675087451935, 0.019355222582817078, -0.021352924406528473, 0.025110192596912384, -0.039689451456069946, -0.0268697589635849, -0.014486649073660374, 0.03273056820034981, -0.00038800571928732097, -0.003601817646995187, -0.023469695821404457, 0.008579536341130733, 0.013249661773443222, -0.0010013317223638296, 0.00654214434325695, -0.014433730393648148, 0.0009004544117487967, 0.0013453069841489196, 0.012257425114512444, -0.004465063102543354, 0.002095272298902273, 0.013626711443066597, -0.010306027717888355, 0.008440623059868813, -0.006747206673026085, -0.013176897540688515, -0.01193329505622387, 0.0030941234435886145, 0.012621245346963406, -0.008758138865232468, -0.010603697970509529, 0.023086030036211014, 0.017582425847649574, 0.016762178391218185, -0.0013990531442686915, -0.0030395505018532276, 0.01149009633809328, 0.010960903018712997, -0.0352177731692791, 0.021220626309514046, 0.0025831216480582952, 0.009776834398508072, 0.018204228952527046, 0.015968389809131622, -0.024104725569486618, -0.0415680855512619, -0.0162065252661705, 0.008480312302708626, 0.01939491182565689, 0.038366470485925674, -0.012720469385385513, 0.009300561621785164, 0.01713261380791664, 0.009637922048568726, 0.002659193240106106, -0.020916340872645378, 0.008758138865232468, 0.022437769919633865, 0.033736031502485275, -0.013309195637702942, -0.7036145925521851, -0.005781429819762707, 0.02657870203256607, 0.009340250864624977, 0.013573791831731796, 0.048447590321302414, 0.025044042617082596, 0.013229817152023315, -0.022570068016648293, 0.03789019584655762, 0.012694009579718113, 0.01755596697330475, 0.007249939721077681, -0.009280717000365257, 0.008943356573581696, 0.0007966830162331462, -0.0035125163849443197, -0.0032479199580848217, 0.006032796576619148, 0.002060543978586793, -0.013123977929353714, 0.006853044964373112, -0.02009609155356884, 0.015333358198404312, 0.004567594267427921, 0.0029866311233490705, 0.017013544216752052, -0.007415312342345715, -0.012680779211223125, 0.021326465532183647, -0.013421649113297462, 0.005874038673937321, 0.007183790672570467, -0.004250078462064266, 0.03889566287398338, -0.0030660100746899843, 0.007772517390549183, 0.022609757259488106, 0.009260871447622776, 0.039821747690439224, -0.010696306824684143, -0.016775408759713173, 0.0036315848119556904, -0.002416095230728388, 0.012376493774354458, 0.006122097838670015, -0.001282465411350131, -0.0008963200962170959, -0.00039586093043908477, -0.0077460575848817825, 0.014949693344533443, 2.4563662464061053e-06, -0.02218640223145485, 0.004898339509963989, 0.005149706266820431, -0.009856213815510273, 0.01616683602333069, -0.018164537847042084, 0.0038961810059845448, 0.023773981258273125, 0.009538698010146618, -0.0025748531334102154, -0.01616683602333069, -0.006985343527048826, -0.014685097150504589, 0.002039045561105013, -0.013745780102908611, -0.014989382587373257, -0.005827734246850014, 0.003171848598867655, -0.003919333219528198, 0.01427497249096632, -0.012237580493092537, 0.0033008393365889788, 0.012839537113904953, 0.026909448206424713, 0.019037706777453423, -0.015320127829909325, -0.006925809197127819, 0.00943947397172451, 0.004521289840340614, -0.007322703488171101, -0.015769941732287407, -0.013706089928746223, 0.035429447889328, -0.01508199144154787, -0.024223795160651207, 0.0038730287924408913, 0.0029982072301208973, 0.010557393543422222, 0.027888454496860504, 0.028682243078947067, 0.007441772148013115, -0.02491174452006817, -0.0038068797439336777, 0.0008574575185775757, -0.027544477954506874, 0.009413015097379684, -0.0010922867804765701, -0.02802075259387493, -0.0025202801916748285, -0.00038283783942461014, -0.01291230134665966, -0.011781152337789536, 0.034371063113212585, 0.009829754009842873, -0.02438255213201046, 0.03921317681670189, 0.026089198887348175, -0.018958328291773796, -0.003962330054491758, 0.006462765391916037, -0.008691989816725254, 0.012621245346963406, 0.009062424302101135, -0.026777150109410286, -0.00434268731623888, 0.015624414198100567, 0.022054104134440422, -0.026711000129580498, -0.006505762692540884, 0.0006577699678018689, 0.019037706777453423, -0.003863106481730938, -0.001573521294631064, 0.025837833061814308, 0.00104267499409616, -0.007428542245179415, -0.018098389729857445, 0.009631306864321232, 0.016629880294203758, -0.0020192007068544626, 0.007944504730403423, -0.01430143229663372, 0.015505345538258553, -0.0245545394718647, -0.002935365540906787, -0.022662676870822906, -0.0022011108230799437, -0.005189395509660244, 0.004706507548689842, 0.0036712742876261473, -0.007488076575100422, -0.005549908149987459, 0.004613898694515228, -0.011840686202049255, -0.006151864770799875, -0.006403231527656317, -0.0014676827704533935, 0.003181770909577608, 0.010550779290497303, 0.0032231141813099384, -0.004064861219376326, 0.017582425847649574, 0.022437769919633865, -0.01673571765422821, 0.007699753623455763, -0.012806463055312634, -0.023773981258273125, -0.008791212923824787, -0.007918045856058598, 0.014499879442155361, -0.023350626230239868, -0.0022060719784349203, -0.007970964536070824, -0.027200503274798393, 0.003704348811879754, 0.010067890398204327, 0.005857501644641161, -0.04585454612970352, 0.02536155842244625, -0.020281309261918068, -0.021789507940411568, 0.014116214588284492, 0.019024476408958435, 0.0049115694127976894, -0.01160916406661272, 0.004567594267427921, -0.003160272492095828, -0.013150437735021114, 0.00810326263308525, -0.004465063102543354, -0.008586151525378227, 0.006122097838670015, 0.026843298226594925, -0.0010203496785834432, 0.005973262246698141, 0.02263621613383293, -0.021524911746382713, 0.018746649846434593, 0.01207882259041071, 0.01407652534544468, -0.014777705073356628, 0.00014542462304234505, 0.013759009540081024, 0.002386328298598528, 0.0006924982299096882, 0.009545313194394112, 0.006082408130168915, 0.017344290390610695, 0.03635553643107414, -0.014116214588284492, 0.018376216292381287, -0.02229224145412445, -0.01633882336318493, -0.02669776976108551, -0.003658044384792447, -0.01570379175245762, 0.020188700407743454, 0.02577168308198452, -0.006287470459938049, -0.01430143229663372, 0.002975055016577244, 0.003188385860994458, 0.025149881839752197, 0.03590572252869606, -0.010610313154757023, 0.00784528162330389, -0.014288201928138733, -0.007230095099657774, -0.0015330050373449922, -0.010418481193482876, 0.008328169584274292, -0.0038101873360574245, 0.007666679099202156, 0.022887583822011948, 0.014804164879024029, 0.03254535049200058, 0.005450684577226639, -0.0015975004062056541, -0.014142674393951893, 0.011119660921394825, 0.009803294204175472, 0.010636772960424423, -0.00019100548524875194, -0.011629008688032627, 0.013090903870761395, -0.0214323028922081, 0.03156634420156479, -0.020069632679224014, -0.0011857222998514771, 0.03204261511564255, 0.03423876687884331, -0.03426522761583328, 0.000992236309684813, 0.01673571765422821, 0.008109877817332745, 0.004656895529478788, 0.02380044013261795, 0.026327336207032204, 0.0010261377319693565, 0.003952407743781805, 0.0021333079785108566, -0.008612610399723053, 0.0018372908234596252, -0.020413607358932495, -0.011979599483311176, 0.01002158597111702, 0.015902239829301834, 0.025149881839752197, 0.001848866930231452, 0.010987362824380398, 0.0062841628678143024, -0.0008648992516100407, 0.010008356533944607, 0.007560840342193842, -0.008043728768825531, -0.0077195982448756695, -0.0018984787166118622, 0.006760436575859785, 0.008169411681592464, -0.002898983657360077, 0.03225429356098175, -0.031063610687851906, 0.02362845279276371, 0.007607144769281149, -0.003988789860159159, 0.005149706266820431, -0.016285903751850128, -0.01805870048701763, -0.023297708481550217, -0.02693590708076954, 0.0044617559760808945, 0.010722766630351543, 0.01007450558245182, -0.008228946477174759, -0.053818896412849426, 0.0007995770429261029, 0.010577238164842129, 0.0168547872453928, 0.007309474050998688, 0.013117363676428795, 0.028470566496253014, -0.021736588329076767, -0.004680047743022442, 0.006403231527656317, 0.034900255501270294, -0.001537139294669032, 0.0033521049190312624, 0.011232114396989346, -0.004431988578289747, 0.0003352931817062199, 0.015730252489447594, -0.01906416565179825, -0.004646973218768835, 0.00506701972335577, -0.01126518938690424, -0.0114967105910182, 0.0034562896471470594, 0.003070971230044961, -0.0052290852181613445, 0.01505553163588047, -0.011205654591321945, -0.0022060719784349203, 0.0028493718709796667, 0.0022689136676490307, -0.02073112316429615, -0.008520002476871014, 0.020519446581602097, -0.023363856598734856, -0.01801901124417782, -0.00935348030179739, -0.0010236570378765464, 0.01063015777617693, 0.055618152022361755, 0.02491174452006817, 0.00219284207560122, -0.013719320297241211, 0.0010774031979963183, 0.018971556797623634, -0.02044006623327732, -0.013004910200834274, -0.015042302198708057, -0.018574662506580353, 0.0023052955511957407, -0.009393169544637203, -0.021061869338154793, 0.030878392979502678, 0.01742366887629032, 0.0024392474442720413, 0.011185809969902039, -0.003024666802957654, -0.003213191870599985, 0.003242958802729845, -0.004134317860007286, -0.0130578288808465, 0.005073634907603264, 0.017714723944664, 0.02217317372560501, -0.00715071614831686, 0.017331060022115707, 0.02263621613383293, -0.00037870349478907883, -0.01488354429602623, -0.0036348921712487936, -0.00016309884085785598, 0.012025903910398483, 0.008467082865536213, 0.012488947249948978, 0.024528080597519875, -0.013798698782920837, 0.014314661733806133, 0.008394318632781506, -0.0027336108032613993, 0.012204506434500217, 0.012316959910094738, 0.010001741349697113, -0.0213793832808733, 0.0009616423049010336, -0.01016049925237894, -0.013930996879935265, 0.02432963252067566, -0.0068133557215332985, -0.015068761073052883, 0.03455628082156181, 0.002693921560421586, -0.01725168153643608, -0.016801867634058, -0.0037076561711728573, 0.006287470459938049, -0.014010376296937466, -0.006899349391460419, -0.0069324239157140255, -0.0024921668227761984, 0.0005680552567355335, -0.020056402310729027, -0.0005941014387644827, 0.0057483552955091, -0.029026217758655548, -0.03990112617611885, -0.02623472735285759, 0.00022077256289776415, -0.012416183017194271, 0.008883821777999401, -0.013342270627617836, -0.006178324576467276, -0.008983045816421509, -0.011516555212438107, 0.0009823138825595379, 0.013587022200226784, 0.0006036104168742895, -0.011602549813687801, 0.020294539630413055, 0.005969954654574394, -0.0014842200325801969, -0.0323072113096714, -0.001845559454523027, -0.023694602772593498, -0.00506701972335577, -0.0031983081717044115, -0.006786895915865898, -0.0044154515489935875, -0.010881524533033371, 0.016722489148378372, 0.02577168308198452, 0.016590191051363945, -0.0027898375410586596, -0.0013056175084784627, 0.009975281544029713, -0.002536817453801632, 0.013487798161804676, 0.006112175527960062, -0.012039133347570896, -0.011562859639525414, 0.011893605813384056, -0.005083557218313217, -0.006571911741048098, -0.009088884107768536, 0.017966091632843018, 0.0020109321922063828, 0.012647705152630806, 0.025970131158828735, -0.003863106481730938, -0.010392021387815475, 0.035006094723939896, -0.012694009579718113, 0.017053233459591866, -0.0019464368233457208, -0.004560979548841715, 0.0067207468673586845, 0.00645615067332983, 0.02942311204969883, -0.02652578242123127, -0.014685097150504589, 0.0031801173463463783, -0.05831703171133995, 0.01731782965362072, 0.007309474050998688, 0.006151864770799875, 0.0011261882027611136, 0.019434601068496704, -0.012991679832339287, 0.002462399657815695, 0.0017264911439269781, -0.00722347991541028, 0.01561118382960558, -0.008116493001580238, -0.01742366887629032, -0.03177801892161369, -0.005897190887480974, -0.012290500104427338, 0.0027666855603456497, -0.009287331253290176, -0.036620132625103, -0.03016398288309574, -0.015121680684387684, 0.013223201967775822, -0.02757093869149685, -0.018389444798231125, -0.04712460935115814, -0.005043867509812117, 0.005821119528263807, -0.0003834579838439822, 0.01363994088023901, -0.006621523294597864, 0.010114194825291634, -0.027359262108802795, -0.028232429176568985, -0.00865230057388544, -0.024303173646330833, -0.00211346335709095, -0.004646973218768835, 0.038604605942964554, 0.028814541175961494, 0.015664102509617805, 0.012224351055920124, 0.008916896767914295, -0.005784737411886454, 0.00361173995770514, 0.018270377069711685, -0.0007164772832766175, 0.0040946281515061855, -0.010226648300886154, 0.014579257927834988, 0.025784913450479507, 0.031883858144283295, 0.004812345840036869, -0.01218466181308031, 0.008268635720014572, 0.01383838802576065, -0.006998572964221239, -2.561985093052499e-05, -0.005563138052821159, -0.019487520679831505, -0.013143823482096195, 0.0017761029303073883, -0.011886990629136562, 0.004706507548689842, 0.013011525385081768, -0.009161648340523243, 0.026208266615867615, 0.027782615274190903, 0.031142989173531532, 0.0013891307171434164, 0.030031684786081314, -0.011165965348482132, 0.03069317527115345, 0.010306027717888355, 0.017873482778668404, 0.019434601068496704, -0.014354350976645947, -0.016841556876897812, -0.018786339089274406, 0.009684225544333458, -0.0013932650908827782, 0.02049298584461212, -0.01522751897573471, -0.007706368342041969, -0.01737074926495552, 0.029687708243727684, -0.01268739439547062, -0.00851338729262352, -0.006667827721685171, -0.010306027717888355, -0.01291230134665966, -0.03902795910835266, -0.014711556024849415, -0.008434007875621319, 0.004613898694515228, 0.0002228397352155298, -0.016722489148378372, 0.033392056822776794, -0.02189534716308117, -0.018376216292381287, 0.002571545774117112, -0.0064363060519099236, 0.021035408601164818, -0.0012187969405204058, 0.01483062468469143, 0.011132891289889812, -0.023019881919026375, -0.02878808230161667, -0.0002664567728061229, -0.011708388105034828, -0.014711556024849415, 0.020916340872645378, 0.0009409707272425294, 0.0011443791445344687, -0.01800578087568283, 0.000309040246065706, -0.010372176766395569, -0.017450127750635147, -0.009373324923217297, 0.012574940919876099, 0.01755596697330475, -0.008890436962246895, -0.01980503648519516, -0.004375761840492487, -0.021405844017863274, 0.026605160906910896, 0.010378791019320488, -0.010782300494611263, -0.008784598670899868, 0.004494830500334501, -0.01422205287963152, 0.019553668797016144, -0.012409567832946777, 0.00979006476700306, 0.02340354584157467, -0.017278140410780907, -0.017238451167941093, 0.005979877430945635, -0.01875988021492958, 0.014552799053490162, -0.007441772148013115, 0.014870313927531242, -0.012118511833250523, 0.0018654041923582554, 0.014632177539169788, -0.007607144769281149, -0.03132820501923561, -0.012204506434500217, -0.00217134365811944, 0.026486093178391457, -0.025110192596912384, 0.01570379175245762, -0.003826724598184228, 8.041247929213569e-05, 0.014380810782313347, 0.0008748216205276549, -0.012601400725543499, -0.028735162690281868, -0.020135780796408653, -0.0011220538290217519, 0.0261685773730278, 0.010650002397596836, -0.0025219337549060583, -0.0034562896471470594, -0.0029585177544504404, -0.0261685773730278, -0.034132927656173706, 0.008791212923824787, 0.002493820386007428, -0.0009062424651347101, -0.01224419567734003, -0.013878078199923038, -0.003188385860994458, 0.008989661000669003, 0.014341121539473534, -0.026486093178391457, 0.02512342296540737, 0.015373047441244125, -0.03246597200632095, -0.00489503238350153, -0.004785886034369469, -0.009161648340523243, -0.029899386689066887, 0.0130578288808465, -0.005351461004465818, -0.019500751048326492, 0.010054660961031914, -0.017529508098959923, -0.020056402310729027, 0.015134910121560097, 0.01268739439547062, 0.011549630202353, 0.013864847831428051, 0.0077460575848817825, 0.01725168153643608, 0.01805870048701763, 0.0060261813923716545, -0.008083418011665344, -0.019619818776845932, 0.012369878590106964, -0.018773110583424568, 0.012416183017194271, -0.007316088769584894, -0.011827456764876842, 0.021207395941019058, -0.016008079051971436, 0.019209694117307663, 0.006991958245635033, -0.023125719279050827, -0.0019398218719288707, -0.0002875417994800955, -0.0006958057056181133, -0.017939630895853043, -0.006462765391916037, -0.0024243639782071114, -0.011622394435107708, -0.023443235084414482, 0.0075806849636137486, 0.011556245386600494, -0.012111897580325603, 0.015849320217967033, -0.0046271285973489285, -0.0023168716579675674, 0.002834488172084093, -0.0035488985013216734, -0.0005949283367954195, -0.008129722438752651, -0.011886990629136562, -0.005824427120387554, -0.009505623020231724, 0.0004758599679917097, 0.03201615810394287, 0.010927828960120678, -0.02438255213201046, -0.01881279982626438, 0.009035964496433735, -0.019143544137477875, -0.008473698049783707, -0.005940187722444534, 0.0011485135182738304, 0.019381681457161903, 0.017847023904323578, 0.0057748151011765, 0.01702677458524704, -0.008844132535159588, 0.020479757338762283, -0.020281309261918068, -0.006912579294294119, 0.014618948101997375, 0.00915503315627575, 0.013653171248733997, -0.007316088769584894, -0.018574662506580353, -0.03307454288005829, 0.008063573390245438, 0.0013717666734009981, -0.010835220105946064, 0.019540440291166306, -0.01195975486189127, -0.01853497326374054, -0.013878078199923038, 0.008235560730099678, -0.02844410575926304, -0.00787835568189621, 0.031248828396201134, -0.0246074590831995, 0.00030842010164633393, 0.010319257155060768, -0.02090311050415039, -0.0017099538818001747, -0.01725168153643608, 0.0015983273042365909, -0.0017083000857383013, 0.016590191051363945, -0.005530063528567553, -0.004742889199405909, 0.022318700328469276, -0.03175156190991402, 0.020757582038640976, 0.008870592340826988, -0.017450127750635147, 0.031142989173531532, -0.0032975319772958755, 0.006879504770040512, -0.016775408759713173, 0.004878494888544083, -0.014050065539777279, 0.0004527077835518867, 0.014235283248126507, -0.017582425847649574, -0.025202801451086998, -0.03098423033952713, -0.021763049066066742, -0.02126031555235386, 0.01201928872615099, -0.030507957562804222, -0.0018257147166877985, -0.0020026634447276592, 0.01800578087568283, 0.0010120810475200415, -0.008844132535159588, -0.013282735832035542, -0.010478015057742596, -0.017741184681653976, 0.010253108106553555, -0.009512238204479218, 0.014804164879024029, -0.0010435017757117748, 0.00023834341845940799, 0.011304878629744053, -0.018336527049541473, -0.018217457458376884, 0.007521151099354029, -0.0010443286737427115, 0.015769941732287407, 0.02628764696419239, 0.20987781882286072, -0.013474568724632263, -0.006310622673481703, 0.047759637236595154, 0.01713261380791664, 0.012892456725239754, 0.013811929151415825, 0.013421649113297462, -0.004779271315783262, 0.035191312432289124, -0.016008079051971436, 0.011873760260641575, -0.016299134120345116, 0.005824427120387554, 0.01488354429602623, 0.0041872370056807995, -0.02496466413140297, -0.018257146701216698, -0.023350626230239868, -0.0019679353572428226, -0.007283014245331287, -0.010550779290497303, -0.02155137248337269, -0.01522751897573471, 0.036276157945394516, 0.00044857346802018583, -0.00984959863126278, -4.550333687802777e-05, 0.008824287913739681, 0.0031007383950054646, -0.020069632679224014, -0.03781081736087799, 0.007970964536070824, 0.01016049925237894, -0.005642517004162073, -0.002612888813018799, 0.007772517390549183, 0.0028179509099572897, 0.030957771465182304, 0.005086864810436964, 0.0020258156582713127, -0.006350311916321516, 0.0034430597443133593, -0.005192703101783991, -0.014843854121863842, -0.003439752385020256, -0.005427532363682985, -0.0169077068567276, -0.0014445306733250618, 0.02136615477502346, -0.03328621760010719, 0.006786895915865898, 0.024528080597519875, 0.03474149852991104, 0.005153013858944178, 9.963705815607682e-05, 0.005602827295660973, 0.0058145043440163136, -0.010458170436322689, 0.007567455060780048, -0.018085159361362457, 0.0337095744907856, -0.005374613218009472, 0.014513108879327774, -0.02913205698132515, 0.00799080915749073, -0.003988789860159159, 8.924958819989115e-05, 0.008943356573581696, -0.008963201195001602, -0.01865404099225998, -0.01500261202454567, 0.006502455100417137, -0.0037275010254234076, -0.015412736684083939, -0.034132927656173706, 0.016008079051971436, 0.016365284100174904, 0.02374752052128315, 0.01574348285794258, 0.004600668791681528, 0.0005688821547664702, -0.007044877391308546, -0.02259652689099312, -0.011192425154149532, -0.021061869338154793, 0.0026790378615260124, 0.019527209922671318, 0.00178437156137079, -0.004732966888695955, -0.0018157924059778452, -0.015624414198100567, -0.006518992129713297, 0.011503325775265694, 0.022675905376672745, 0.013104133307933807, 0.0036481220740824938, 0.018601123243570328, -0.019249383360147476, 0.02501758374273777, -0.02559969574213028, -0.007402082439512014, -0.0068596601486206055, 0.013759009540081024, -0.008500156924128532, 0.019672738388180733, 0.0034529822878539562, 0.0002637694706209004, 0.001343653304502368, -0.01726491190493107, -0.019831495359539986, -0.016352053731679916, -0.00216307514347136, -0.006340389605611563, 0.019355222582817078, 0.008817672729492188, 0.012052362784743309, -0.009075654670596123, 0.0012121819891035557, 0.00992897804826498, 0.012978450395166874, -0.005526755936443806, 0.0024309789296239614, -0.0011336299357935786, -0.008493542671203613, -0.01587578095495701, -0.018852489069104195, -0.004253386054188013, 0.007699753623455763, -0.030428579077124596, -0.005582982674241066, -0.011218884959816933, 0.026142118498682976, -0.005596212577074766, -0.013249661773443222, -0.005222470033913851, 0.0009302215185016394, 0.00044733317918144166, -0.005460606887936592, 0.016934165731072426, 0.00039131316589191556, -0.020889880135655403, 0.0027468407060950994, 0.017714723944664, -0.007812207099050283, -0.02559969574213028, 0.025110192596912384, -0.02079727128148079, -0.011629008688032627, 0.0017000314546748996, -0.02033422887325287, 0.003095777239650488, -0.0076732938177883625, 0.0010906329844146967, 0.03064025565981865, -0.003916025627404451, -0.03143404424190521, -0.03336559981107712, -0.001071615144610405, -0.007263169623911381, -0.005361383315175772, -0.0020158933475613594, 0.018786339089274406, 0.0031867320649325848, -0.02172335982322693, -0.02524249069392681, -0.1726226508617401, 0.049029700458049774, 0.005831041838973761, -0.026724230498075485, 0.020413607358932495, 0.01795286126434803, 0.023377086967229843, -0.0012766773579642177, 0.00038366467924788594, 0.013375344686210155, 0.01587578095495701, 0.0004303824680391699, -0.03484733775258064, -0.0038399542681872845, -0.0126278605312109, -0.007653449196368456, 0.01731782965362072, 0.006773666478693485, 0.004336072597652674, 0.034423984587192535, 0.03786373510956764, -0.024832366034388542, 0.003003168385475874, -0.00214984524063766, 0.008314940147101879, -0.004769349005073309, 0.007481461390852928, 0.018839258700609207, 0.012052362784743309, 0.00210023345425725, -0.02126031555235386, -0.014499879442155361, 0.01881279982626438, 0.011390872299671173, 0.011688543483614922, 0.003654737025499344, 0.0031685412395745516, -0.0245545394718647, -0.012958605773746967, 0.022900812327861786, 0.0261685773730278, 0.030613796785473824, 0.00787835568189621, -0.017516277730464935, -0.01430143229663372, 0.014592488296329975, 0.016841556876897812, 0.010411866009235382, 0.015373047441244125, -0.017714723944664, 0.010001741349697113, -0.009194722399115562, 0.00503725279122591, 0.0004349302325863391, 0.021987956017255783, 0.0035852803848683834, 0.003110660705715418, 0.015994848683476448, 0.016894476488232613, 0.00017085067520383745, -0.012032518163323402, -0.004931414034217596, 0.019077396020293236, -0.006029488984495401, 0.01070953719317913, -0.015187829732894897, -0.01160916406661272, 0.018720190972089767, -0.01407652534544468, 0.028523486107587814, 0.007918045856058598, -0.03852522745728493, 0.0036811965983361006, -0.04048324003815651, 0.02107509784400463, 0.01882603019475937, -0.023244788870215416, 0.007230095099657774, -0.016537271440029144, -0.006535529624670744, -0.02136615477502346, 0.011285034008324146, -0.009677611291408539, 0.006912579294294119, 0.006608293391764164, 0.0017116075614467263, 0.010874909348785877, -0.002783222822472453, -0.020294539630413055, -0.03717578575015068, 0.02194826677441597, -0.013170282356441021, -0.004445218481123447, -0.02073112316429615, 0.017503047361969948, 0.006145250052213669, 0.01016049925237894, 0.014314661733806133, -0.01580963097512722, -0.0042269267141819, 0.008407549001276493, -0.002726996084675193, -0.018442364409565926, 0.016590191051363945, 0.02491174452006817, -0.01951397955417633, 0.01911708526313305, 0.022252552211284637, 0.008949970826506615, -0.02033422887325287, -0.005291926674544811, 0.007620374672114849, 0.012436027638614178, 0.03328621760010719, 0.0018869026098400354, 0.012568325735628605, -0.0011774536687880754, -0.007620374672114849, 0.003694426268339157, -0.016894476488232613, 0.041832681745290756, -0.013342270627617836, -0.007276399526745081, -0.010669847019016743, -0.004603976383805275, 0.005946802906692028, -0.12118512392044067, -0.03659367188811302, 0.0014991036150604486, 0.01508199144154787, -0.02212025411427021, 0.03347143530845642, 0.010888139717280865, 0.007421927060931921, -0.013587022200226784, 0.04037740081548691, -0.01199282892048359, -0.025679074227809906, -0.029687708243727684, 0.00283779576420784, 0.020347459241747856, -0.013679631054401398, -0.015293668024241924, -0.008255405351519585, -0.005014100577682257, 0.004795808810740709, 0.001526390085928142, -0.002328447764739394, 0.007613759487867355, -0.007335933391004801, -0.004574208986014128, -0.0013155399356037378, 0.002348292386159301, 0.022543607279658318, 0.017053233459591866, -0.013653171248733997, 0.009373324923217297, -0.03312746062874794, 0.013236431404948235, -0.01427497249096632, -0.005318386480212212, 0.0025963515508919954, -0.04945305734872818, 0.022093793377280235, 0.018045470118522644, -0.026393484324216843, 0.019910873845219612, 0.01271385420113802, 0.0037208860740065575, -0.04252063110470772, 0.011159350164234638, -0.021405844017863274, -0.01068307738751173, 0.0351119339466095, 0.009148417972028255, -0.0014751246199011803, -0.03058733604848385, -0.01586255058646202, -0.034423984587192535, -0.008381089195609093, 0.027650317177176476, -0.0018968250369653106, 0.014288201928138733, 0.01946105994284153, -0.012832922860980034, 0.02189534716308117, 0.010788915678858757, 0.005549908149987459, -0.004901647102087736, 0.02865578420460224, -0.007230095099657774, -0.021815968677401543, -0.012872612103819847, 0.005103401839733124, 0.0004518809437286109, -0.010180343873798847, -0.008619225583970547, -6.78544893162325e-05, -0.014817395247519016, 0.012568325735628605, -0.02618180774152279, 0.013123977929353714, -0.02512342296540737, -0.01928907260298729, 0.004150854889303446, -0.02594367042183876, -0.028391188010573387, -0.015664102509617805, 0.0169077068567276, -0.0024987817741930485, 0.013573791831731796, -0.0007007668609730899, -0.002819604706019163, -0.012052362784743309, -0.003446367336437106, -0.032915785908699036, -0.003302493132650852, -0.003952407743781805, 0.00937994010746479, -0.004422066267579794, 0.012336804531514645, 0.020347459241747856, -0.0060261813923716545, -0.008830903097987175, 0.016127146780490875, 0.009677611291408539, -0.018521742895245552, -0.00865230057388544, -0.062285978347063065, 0.03781081736087799, -0.004117780365049839, 0.00564913172274828, 0.010127425193786621, 3.0361396056832746e-05, 0.020876651629805565, -0.01048463024199009, -0.009532082825899124, -0.016127146780490875, -0.021300004795193672, -0.0007673293584957719, -0.006965498439967632, 0.005678899120539427, -0.033048082143068314, -0.006707516964524984, 0.016193296760320663, 0.0022193018812686205, 0.020942799746990204, 0.011245344765484333, 0.007488076575100422, -0.020400376990437508, 0.013719320297241211, -0.0077460575848817825, -0.003234690288081765, 0.016484351828694344, -0.017516277730464935, 0.014804164879024029, 0.016709258779883385, -0.01137764286249876, 0.004031786695122719, -0.02942311204969883, 0.01789994165301323, 0.01569056324660778, 0.004971103742718697, -0.002225916599854827, 0.0071441009640693665, 0.015333358198404312, -0.00485203554853797, 0.016603419557213783, -0.027438640594482422, -0.025970131158828735, 0.008797828108072281, -0.002497127978131175, 0.008447238244116306, 0.010292797349393368, -0.0002470254839863628, -0.005245622247457504, 0.012369878590106964, 0.006826585624366999, 0.004742889199405909, 0.008897052146494389, -0.023152180016040802, -0.008804443292319775, -0.017860252410173416, 0.00021291736629791558, -0.0028890613466501236, 0.009545313194394112, -0.0017215298721566796, -0.011079971678555012, 0.017979322001338005, 0.0075806849636137486, 0.013209972530603409, -0.00045560181024484336, 0.005735125858336687, 0.004382377024739981, -0.019368451088666916, -0.010530934669077396, 0.009141803719103336, -0.03011106327176094, -0.022861123085021973, -0.007739442866295576, -0.010934443213045597, -0.0008665529894642532, 0.024686837568879128, 0.009611462242901325, -0.002745186910033226, 0.023059571161866188, -0.01801901124417782, 0.02844410575926304, 0.013891307637095451, 0.0077659026719629765, -0.03976882994174957, -0.0020985796581953764, 0.021220626309514046, 0.028629323467612267, -0.010788915678858757, 0.0015710407169535756, -0.006760436575859785, 0.01882603019475937, -0.02282143384218216, -0.016259444877505302, 0.0076732938177883625, 0.011443791911005974, -0.010815375484526157, -0.009763604961335659, -0.0022193018812686205, -0.0021200780756771564, 0.02647286280989647, 0.022861123085021973, 0.014751246199011803, 0.00500748585909605, -0.008149567060172558, -0.018561434000730515, 0.003042857861146331, -0.002680691657587886, -0.02200118638575077, -0.044743239879608154, -0.01024649292230606, 0.01346795354038477, 0.019355222582817078, 0.007269784342497587, 0.01254186686128378, 0.018839258700609207, -0.014261743053793907, 0.005351461004465818, -0.011629008688032627, -0.009135188534855843, -0.03294224292039871, 0.03267764672636986, 0.004957873839884996, -0.003001514822244644, 0.021670440211892128, -0.015994848683476448, 0.026380255818367004, -0.006750514265149832, -0.006297392770648003, -0.005659054033458233, 0.010874909348785877, -0.0024590922985225916, 0.009644536301493645, -0.010669847019016743, -0.01065661758184433, -0.01969919726252556, -0.02136615477502346, 0.009836369194090366, -0.00033281257492490113, 0.027412179857492447, -0.02078404277563095, 0.06694287061691284, -0.011285034008324146, -0.006598371081054211, 0.010861679911613464, 0.011509940959513187, 0.020426837727427483, 0.007560840342193842, 0.005103401839733124, -0.014671866782009602, -0.006773666478693485, -0.0048818024806678295, -0.01432789210230112, -0.013573791831731796, 0.00031503502395935357, -0.018865719437599182, 0.007646834012120962, -0.011192425154149532, 0.015822861343622208, -0.021286776289343834, 0.004359224811196327, 0.012548481114208698, -0.012965220957994461, 0.013216586783528328, -0.00713748624548316, -0.007302858866751194, -0.010557393543422222, 0.00036113266833126545, 0.0016752255614846945, -0.03151342272758484, -0.015095220878720284, 0.004210389219224453, 9.379733819514513e-05, -0.01788671314716339, -0.011331338435411453, 0.020532675087451935, -0.019487520679831505, -0.004451833199709654, -0.02316540852189064, -0.0077659026719629765, 0.005500296596437693, 0.011939909309148788, 0.005136476363986731, -0.020823732018470764, -0.02357553318142891, 0.02907913736999035, 0.002404519123956561, -0.01644466258585453, -0.00511001655831933, -0.006036104168742895], index=0, object='embedding')], model='text-embedding-ada-002-v2', object='list', usage=Usage(prompt_tokens=1, total_tokens=1))
"""
